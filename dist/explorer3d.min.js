!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Explorer3d=e.Explorer3d||{})}(this,function(e){"use strict";function t(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}function i(e){return e.split(/\s+/g).map(function(e){return e.replace(/\"/g,"")})}function n(e){var t=e.split(/\s+/g),i=(t.length,{get xyz(){return[this.x,this.y,this.z]}});return t.forEach(function(e,t){switch(t){case 0:break;case 1:i.index=parseInt(e);break;case 2:i.vertexId=parseFloat(e);break;case 3:i.properties=[];default:i.properties.push(e)}}),i}function r(e,t,i){var n=e.split(/\s+/g),r=(n.length,i?i:1),o=[],s={get xyz(){return[this.x,this.y,this.z]},get all(){var e=[this.x,this.y,this.z];return this.properties&&this.properties.forEach(function(t){e.push(t)}),e}};return n.forEach(function(e,t){switch(t){case 0:break;case 1:s.index=parseInt(e);break;case 2:o[0]=parseFloat(e);break;case 3:o[1]=parseFloat(e);break;case 4:s.z=parseFloat(e)*r;break;case 5:s.properties=[];default:s.properties.push(e)}}),t&&(o=t(o)),s.x=o[0],s.y=o[1],s}function o(e){return"true"===e}function s(e){return e}function a(e){if(e){var t=e.trim().split(/\s+/g);return 1===t.length&&0===t[0].indexOf("#")?parseInt("0x"+t[0].substring(1)):255*parseFloat(t[0])*256*256+255*parseFloat(t[1])*256+255*parseFloat(t[2])}return null}function h(e){var t=e.split(/\s+/g);return{id:+t[1],vertices:[+t[2],+t[3]]}}function c(e){var t=e.split(/\s+/g),i=t.length,n={get abc(){return[this.a,this.b,this.c]}};return 4===i&&(n.a=parseInt(t[1]),n.b=parseFloat(t[2]),n.c=parseFloat(t[3])),n}function l(e){var t=e.split(/\s+/g);return parseInt(t[1])}function p(e){var t=e.split(/\s+/g);return[parseInt(t[1]),parseInt(t[2])]}function u(e){var t=e.split(/\s+/g);return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3]),parseInt(t[4])]}function d(e){var t=e.split(/\s+/g);return t.shift(),t}function f(e,t){var i=Array.isArray(t),n=i&&[]||{};if(Array.isArray(t)){var r=n;e=e||[],r=r.concat(e),t.forEach(function(t,i){"undefined"==typeof r[i]?r[i]=t:"object"==typeof t?r[i]=f(e[i],t):e.indexOf(t)===-1&&r.push(t)})}else e&&"object"==typeof e&&Object.keys(e).forEach(function(t){n[t]=e[t]}),Object.keys(t).forEach(function(i){"object"==typeof t[i]&&t[i]&&e[i]?n[i]=f(e[i],t[i]):n[i]=t[i]});return n}function v(e,t){var i,n,r,o=-1,s=e.length;if(null==t){for(;++o<s;)if(null!=(n=e[o])&&n>=n){i=r=n;break}for(;++o<s;)null!=(n=e[o])&&(i=Math.min(i,n),r=Math.max(r,n))}else{for(;++o<s;)if(null!=(n=t(e[o],o,e))&&n>=n){i=r=n;break}for(;++o<s;)null!=(n=t(e[o],o,e))&&(i=Math.min(i,n),r=Math.max(r,n))}return[i,r]}function E(e){if("undefined"!=typeof DOMParser)return(new DOMParser).parseFromString(e,"text/xml");if("undefined"!=typeof ActiveXObject&&new ActiveXObject("Microsoft.XMLDOM")){var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}return null}function x(e){var t=new THREE.Geometry;return e.borders.forEach(function(i){var n=e.vertices[i[0]];t.vertices.push(new THREE.Vector3(n[0],n[1],n[2])),n=e.vertices[i[1]],t.vertices.push(new THREE.Vector3(n[0],n[1],n[2]))}),t.vertices.length?(t.computeBoundingBox(),new THREE.LineSegments(t,new THREE.LineBasicMaterial({linewidth:10,color:16711935}))):null}function m(e){var t=new THREE.Geometry;if(e.bstones.forEach(function(i){var n=e.vertices[i];if(n){var r=new THREE.Vector3(n[0],n[1],n[2]);t.vertices.push(r)}}),t.vertices.length){t.computeBoundingBox();var i=new THREE.PointsMaterial({size:16384});return new THREE.Points(t,i)}return null}function y(e){var t=v(e.vertices,function(e){return e?+e[3]:null}),i=new THREE.LineBasicMaterial({linewidth:10,color:16777215,vertexColors:THREE.VertexColors}),n=new THREE.Geometry,r=new THREE.Lut("rainbow",Math.floor(t[1]-t[0]));return r.setMax(Math.floor(t[1])),r.setMin(Math.floor(t[0])),e.lines.forEach(function(t){t.forEach(function(t,i){var o=e.vertices[t[0]];n.vertices.push(new THREE.Vector3(o[0],o[1],o[2])),n.colors.push(r.getColor(parseInt(o[3]))),o=e.vertices[t[1]],n.vertices.push(new THREE.Vector3(o[0],o[1],o[2])),n.colors.push(r.getColor(parseInt(o[3])))})}),n.computeBoundingBox(),n.computeBoundingSphere(),new THREE.LineSegments(n,i)}function g(e){var t=new THREE.Geometry,i=e.header.solidColor,n=new THREE.MeshLambertMaterial({color:i?i:16716049,side:THREE.DoubleSide});e.vertices.forEach(function(e){t.vertices.push(new THREE.Vector3(e[0],e[1],e[2]))}),e.faces.forEach(function(e){t.faces.push(new THREE.Face3(e[0]-1,e[1]-1,e[2]-1))}),t.computeBoundingBox(),t.computeFaceNormals();var r=new THREE.Mesh(t,n);return r}function T(e){var t=new THREE.Geometry,i=e.header.color;e.vertices.forEach(function(e){var i=new THREE.Vector3(e[0],e[1],e[2]);t.vertices.push(i)});var n=new THREE.PointsMaterial({size:16,color:i}),r=new THREE.Points(t,n);return t.computeBoundingBox(),t.computeBoundingSphere(),t.computeFaceNormals(),r}var b=function(){function e(e){this.isValid=!0,this.typeMap={AXIS_NAME:i,AXIS_UNIT:i};var t=e.nextDataLine().trim();if("GOCAD_ORIGINAL_COORDINATE_SYSTEM"!==t)e.previous(),this.isValid=!1;else for(t=e.nextDataLine().trim();t&&"END_ORIGINAL_COORDINATE_SYSTEM"!==t;){var n=t.indexOf(" ");if(n>0){var r=t.substring(0,n),o=t.substring(n).trim(),s=this.typeMap[r]?this.typeMap[r]:function(e){return e};this[r]=s(o)}t=e.nextDataLine().trim()}this.typeMap=null}return e}(),O=function(){function e(){}return e.prototype.apply=function(t){t.addEventListener=e.prototype.addEventListener,t.hasEventListener=e.prototype.hasEventListener,t.removeEventListener=e.prototype.removeEventListener,t.dispatchEvent=e.prototype.dispatchEvent},e.prototype.addEventListener=function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)},e.prototype.hasEventListener=function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&i[e].indexOf(t)!==-1},e.prototype.removeEventListener=function(e,t){if(void 0!==this._listeners){var i=this._listeners,n=i[e];if(void 0!==n){var r=n.indexOf(t);r!==-1&&n.splice(r,1)}}},e.prototype.dispatchEvent=function(){},e}(),R=function(e){function i(t,i){e.call(this),this.type="Type",this.projectionFn=function(e){return e},this.isValid=!1,this.reader=t,i&&(this.projectionFn=i)}return t(i,e),i.prototype.clear=function(){this.reader=null},i}(O),w=function(){function e(e){this.values={},this.typeMap={ivolmap:o,imap:o,parts:o,mesh:o,cn:o,border:o,"*solid*color":a};for(var t=e.nextDataLine().trim();t&&0!==t.indexOf("}");){var i=t.split(":");if(2===i.length){var n=this.typeMap[i[0]];n=n?n:s,this.values[i[0]]=n(i[1])}else console.warn("That doesn't look like a pair: "+t);t=e.nextDataLine().trim()}this.name=this.values.name,this.solidColor=this.values["*solid*color"],this.solidColor=this.solidColor?this.solidColor:15658734,this.typeMap=null}return e.prototype.toColor=function(e){return a(e)},e.prototype.toBool=function(e){return o(e)},e}(),H=function(e){function i(t,i){e.call(this,t,i),this.type="TSurf",this.vertices=[],this.faces=[],this.bstones=[],this.borders=[];var o=t.expects("HEADER");if(o&&o.indexOf("{")!==-1){this.header=new w(t);var s=new b(t),a=1;for(s.isValid&&(this.coordinateSystem=s,a="Depth"===this.coordinateSystem.ZPOSITIVE?-1:1),o=t.expects("TFACE");"END"!==(o=t.nextDataLine().trim());)if(0===o.indexOf("VRTX")||0===o.indexOf("PVRTX")){var p=r(o,this.projectionFn,a);this.vertices[p.index]=p.all}else if(0===o.indexOf("ATOM")||0===o.indexOf("PATOM")){var u=n(o);this.vertices[u.index]=this.vertices[u.vertexId]}else if(0===o.indexOf("TRGL"))this.faces.push(c(o).abc);else if(0===o.indexOf("BSTONE"))this.bstones.push(l(o));else if(0===o.indexOf("BORDER")){var d=h(o);this.borders[d.id]=[d.vertices[0],d.vertices[1]]}this.clear()}}return t(i,e),i}(R),S=function(e){function i(t){e.call(this,t),this.paintedVariable=this.values["*painted*variable"];var i=this.values["*line*color"];this.color=i?this.toColor(i):255}return t(i,e),i}(w),L=function(e){function i(t,i){e.call(this,t,i),this.type="PLine",this.vertices=[],this.lines=[];var o=t.expects("HEADER");if(o&&o.indexOf("{")!==-1){this.header=new S(t);var s=new b(t),a=1;s.isValid&&(this.coordinateSystem=s,a="Depth"===this.coordinateSystem.ZPOSITIVE?-1:1),o=t.expects("ILINE");var h=1,c=1,l=!1,u=[];o=t.nextDataLine();for(var d="}"===(o?o.trim():"}");!d;){if(0===o.indexOf("VRTX")||0===o.indexOf("PVRTX")){var f=r(o,this.projectionFn,a);this.vertices[f.index]=f.all,c=f.index}else if(0===o.indexOf("ATOM")||0===o.indexOf("PATOM")){var v=n(o);this.vertices[v.index]=this.vertices[v.vertexId]}else if(0===o.indexOf("SEG"))u.push(p(o)),l=!0;else if(0===o.indexOf("ILINE")||0===o.indexOf("END")){if(d=0===o.indexOf("END"),!l&&c>h)for(var E=h;E<c;E++)u.push([E,E+1]);this.lines.push(u),u=[],h=c+1,l=!1}d=!t.hasMore(),d||(d="}"===(o=t.nextDataLine().trim()))}this.clear()}}return t(i,e),i}(R),A=function(e){function i(t,i){e.call(this,t,i),this.type="TSolid",this.vertices=[],this.tetras=[];var o=t.expects("HEADER");if(o){this.header=new w(t);var s=new b(t),a=1;for(s.isValid&&(this.coordinateSystem=s,a="Depth"===this.coordinateSystem.ZPOSITIVE?-1:1),o=t.expects("TVOLUME");"END"!==(o=t.nextDataLine().trim());)if(0===o.indexOf("VRTX")||0===o.indexOf("PVRTX")){var h=r(o,this.projectionFn,a);this.vertices[h.index]=h.all}else if(0===o.indexOf("ATOM")||0===o.indexOf("PATOM")){var c=n(o);this.vertices[c.index]=this.vertices[c.vertexId]}else 0===o.indexOf("TETRA")&&this.tetras.push(u(o));this.clear()}}return t(i,e),i}(R),C=function(e){function i(t){e.call(this,t),this.color=this.toColor(this.values["*atoms*color"])}return t(i,e),i}(w),M=function(e){function i(t,i){e.call(this,t,i),this.type="VSet",this.vertices=[];var o=t.expects("HEADER");if(o&&o.indexOf("{")!==-1){this.header=new C(t);var s=new b(t),a=1;for(s.isValid&&(this.coordinateSystem=s,a="Depth"===this.coordinateSystem.ZPOSITIVE?-1:1);"END"!==(o=t.nextDataLine().trim());)if(0===o.indexOf("VRTX")||0===o.indexOf("PVRTX")){var h=r(o,i,a);this.vertices[h.index]=h.all}else if(0===o.indexOf("ATOM")||0===o.indexOf("PATOM")){var c=n(o);this.vertices[c.index]=this.vertices[c.vertexId]}this.clear()}}return t(i,e),i}(R),k=function(e){function i(t,i){for(e.call(this,t,i),this.type="Unknown";t.hasMore();){var n=t.next().trim();if("END"===n)break}this.clear()}return t(i,e),i}(R),D=function(){function e(e,t){if(this.isValid=!1,e.hasMore()){var i=e.next().trim(),n=i.split(/\s+/g);this.isValid=3===n.length&&"GOCAD"===n[0]&&("1.0"===n[2]||"1"===n[2]),this.isValid&&(this.version=n[2],"TSurf"===n[1]?this.type=new H(e,t):"PLine"===n[1]?this.type=new L(e,t):"TSolid"===n[1]?this.type=new A(e,t):"VSet"===n[1]?this.type=new M(e,t):this.type=new k(e,t))}}return e}(),V=function(){function e(e,t){if(this.types=[],this.reader=e,e.hasMore()){var i=new D(e,t);i.isValid&&this.types.push(i.type)}this.clean()}return e.prototype.clean=function(){this.reader=null,this.types&&this.types.forEach(function(e){e.projectionFn=null})},e}(),P=function(){function e(e,t){var i=this;this.isValid=!0,this.names={},this.range={min:null,max:null},this.terminator="}",t=t?t:[],t.push(this.terminator);var n=e.nextDataLine().trim();if(this.isValid=!1,0!==n.indexOf("PROPERTIES"))e.previous();else{var r=d(n);for(r.length&&r.forEach(function(e){i.names[e]={}}),this.isValid=!0,n=e.nextDataLine().trim();;){var o=d(n);if(0===n.indexOf("PROP_LEGAL_RANGES")&&2===o.length?("**none**"!==o[0]&&(this.range.min=parseFloat(o[0])),"**none**"!==o[1]&&(this.range.min=parseFloat(o[1]))):0===n.indexOf("PROPERTY_CLASSES")&&o.length>0?o.forEach(function(e,t){i.names[r[t]].className=e}):0===n.indexOf("UNITS")&&o.length>0&&o.forEach(function(e,t){i.names[r[t]].unit=e}),n=e.nextDataLine()?n.trim():"}",0===n.indexOf("}"))break}}}return e}(),I=function(){function e(e,t){if(e){var i=e.split(/\s+/g),n=t([parseFloat(i[0]),parseFloat(i[1])]);this.x=n[0],this.y=n[1],this.z=parseFloat(i[2])}}return e}(),z=function(){function e(e,t,i){this.PAGE_SIZE=1048576,this.file=e,this.length=e.size,this.handler=t,this.errorHandler=i,this.pageNo=this.index=0,this.lineBuffer=[],this.process()}return e.prototype.process=function(){this.readPage()},e.prototype.readPage=function(){function e(e){for(var t=0;t<e.length;t++){var i=e[this.index];"\r"!==i&&("\n"!==i?this.lineBuffer.push(e[t]):(this.handler(this.lineBuffer.join("")),this.lineBuffer=[]))}}var t=this,i=this.pageNo*this.PAGE_SIZE;i>=this.length&&this.complete();var n=new FileReader,r=this.file.slice(i,i+this.PAGE_SIZE);n.onloadend=function(i){if(i.target.readyState===FileReader.prototype.DONE){var n=i.target.result;e(n),t.pageNo++,t.readPage()}},n.readAsText(r)},e.prototype.complete=function(){this.lineBuffer.length&&this.handler(this.lineBuffer.join("")),this.handler(null)},e}(),F=function(){function e(e){this.indexStack=[],this.data=e,this.length=e.length,this.index=0}return e.prototype.hasMore=function(){return this.index<this.length-1},e.prototype.peek=function(){this.next();this.previous()},e.prototype.previous=function(){this.indexStack.length&&(this.index=this.indexStack.pop())},e.prototype.next=function(){this.indexStack.push(this.index);for(var e=[];this.index<this.length;this.index++){var t=this.data[this.index];if("\r"!==t){if("\n"===t){this.index++;break}e.push(this.data[this.index])}}return e?e.join(""):null},e.prototype.expects=function(e){for(;this.hasMore();){var t=this.next();if(!t.indexOf(e))return t}return null},e.prototype.nextNonEmpty=function(){for(;this.hasMore();){var e=this.next();if(e)return e}return null},e.prototype.nextDataLine=function(){for(var e=this.nextNonEmpty();e;){if(e.indexOf("#"))return e;e=this.nextNonEmpty()}return e},e}(),j=function(){function e(){this.geometry=new THREE.Geometry,this.userData={}}return e.prototype.setHeader=function(e){this.userData.header=e;var t=e.solidColor;this.material=new THREE.MeshLambertMaterial({color:t?t:16716049,side:THREE.DoubleSide})},e.prototype.setVertices=function(e){var t=this;e.forEach(function(e){t.geometry.vertices.push(new THREE.Vector3(e[0],e[1],e[2]))})},e.prototype.setCoordinateSystem=function(e){this.userData.coordinateSystem=e},e.prototype.setFaces=function(e){var t=this;e.forEach(function(e){t.geometry.faces.push(new THREE.Face3(e[0]-1,e[1]-1,e[2]-1))})},e.prototype.createMesh=function(){this.geometry.computeBoundingBox(),this.geometry.computeFaceNormals();var e=new THREE.Mesh(this.geometry,this.material);return e.userData=this.userData,e},e}(),B=function(){function e(){}return e.add=function(e,t){return t=t?t:{},t.vertexShader=this.VertexShader[e],t.fragmentShader=this.FragmentShader[e],t},e.VertexShader={COLOR_RAMP:"attribute vec3 customColor;\nvarying vec3 vColor;\nvoid main() {\n\tvColor = customColor;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},e.FragmentShader={COLOR_RAMP:"uniform vec3 color;\n\nvarying vec3 vColor;\nvoid main() {\n\tgl_FragColor = vec4( vColor * color, 1 );\n}"},e}(),N=function(){function e(e,t){function i(){a.continueAnimation&&(window.requestAnimationFrame(i),a.camera.lookAt(a.lookAt),a.renderer.render(a.scene,a.camera),a.controls.update(.02))}this.options={camera:{fov:45,near:.1,far:5e5,position:{x:-30,y:40,z:30},up:{x:0,y:1,z:0}},lights:{ambient:{color:5592405},directional:{color:10526880,center:{x:0,y:0,z:0},position:{dx:50,dy:10,dz:-300}}},axisHelper:{on:!0,size:20}},this.lights=[],this.options=f(this.options,t?t:{});var n=document.body.getBoundingClientRect();"string"==typeof e?this.container=document.getElementById(""+e):this.container=e,this.scene=new THREE.Scene,this.renderer=new THREE.WebGLRenderer({clearColor:16711680}),this.renderer.setSize(n.width,n.height);var r=this.options.camera;this.camera=new THREE.PerspectiveCamera(r.fov,n.width/n.height,r.near,r.far),this.camera.up.set(r.up.x,r.up.y,r.up.z);var o=r.position;if(this.camera.position.x=o.x,this.camera.position.y=o.y,this.camera.position.z=o.z,t.camera.lookAt){var s=t.camera.lookAt;this.lookAt=new THREE.Vector3(s.x,s.y,s.z)}else this.lookAt=this.scene.position;this.camera.lookAt(this.lookAt),this.container.appendChild(this.renderer.domElement),this.renderer.render(this.scene,this.camera),this.axisHelper(this.options.axisHelper.on),this.addLights(),this.addFlyControls(),this.resizer=THREEExt.WindowResize(this.renderer,this.camera,this.container);var a=this;this.continueAnimation=!0,i()}return e.prototype.resize=function(e){this.options=f(this.options,e?e:{});var t=this.options.axisHelper.on;this.axisHelper(!1),this.axisHelper(t),this.updateLights();var i=e.camera.lookAt;this.lookAt=new THREE.Vector3(i.x,i.y,i.z),this.camera.far=e.camera.far,this.camera.near=e.camera.near,this.camera.lookAt(this.lookAt)},e.prototype.update=function(e){this.options=f(this.options,e?e:{});var t=this.options.camera;this.camera.up.set(t.up.x,t.up.y,t.up.z);var i=t.position;if(this.camera.position.x=i.x,this.camera.position.y=i.y,this.camera.position.z=i.z,e.camera.lookAt){var n=e.camera.lookAt;this.lookAt=new THREE.Vector3(n.x,n.y,n.z)}else this.lookAt=this.scene.position;this.camera.lookAt(this.lookAt),this.controls.movementSpeed=this.options.radius;var r=this.options.axisHelper.on;this.axisHelper(!1),this.axisHelper(r),this.updateLights()},e.prototype.destroy=function(){for(this.renderer.domElement.addEventListener("dblclick",null,!1),this.scene=null,this.camera=null,this.controls=null;this.container.lastChild;)this.container.removeChild(this.container.lastChild);this.continueAnimation=!1},e.prototype.addLabels=function(e){function t(t,n){var r=f({fontface:"Arial",fontsize:18,borderThickness:4,borderColor:{r:0,g:0,b:0,a:1},backgroundColor:{r:255,g:255,b:255,a:1}},n?n:{}),o=document.createElement("canvas"),s=o.getContext("2d");s.font=r.fontsize+"px "+r.fontface;var a=s.measureText(t),h=a.width;s.fillStyle="rgba("+r.backgroundColor.r+","+r.backgroundColor.g+","+r.backgroundColor.b+","+r.backgroundColor.a+")",s.strokeStyle="rgba("+r.borderColor.r+","+r.borderColor.g+","+r.borderColor.b+","+r.borderColor.a+")",s.lineWidth=r.borderThickness,i(s,r.borderThickness/2,r.borderThickness/2,h+r.borderThickness,1.4*r.fontsize+r.borderThickness,6),s.fillStyle="rgba(0, 0, 0, 1.0)",s.fillText(t,r.borderThickness,r.fontsize+r.borderThickness);var c=new THREE.Texture(o);c.needsUpdate=!0;var l=new THREE.SpriteMaterial({map:c}),p=new THREE.Sprite(l);return p.scale.set(35*e,15*e,1),p}function i(e,t,i,n,r,o){e.beginPath(),e.moveTo(t+o,i),e.lineTo(t+n-o,i),e.quadraticCurveTo(t+n,i,t+n,i+o),e.lineTo(t+n,i+r-o),e.quadraticCurveTo(t+n,i+r,t+n-o,i+r),e.lineTo(t+o,i+r),e.quadraticCurveTo(t,i+r,t,i+r-o),e.lineTo(t,i+o),e.quadraticCurveTo(t,i,t+o,i),e.closePath(),e.fill(),e.stroke()}this.labels&&this.scene.remove(this.labels);var n=this.labels=new THREE.Object3D,r=this.options.axisHelper.position,o=this.options.axisHelper.size,s=this.options.axisHelper.labels,a={fontsize:64,backgroundColor:{r:255,g:200,b:200,a:.7}},h=t(s.x,a);return h.position.set(r.x+o,r.y,r.z),n.add(h),a.backgroundColor={r:200,g:255,b:200,a:.7},h=t(s.y,a),h.position.set(r.x,r.y+o,r.z),n.add(h),a.backgroundColor={r:200,g:200,b:255,a:.7},h=t(s.z,a),h.position.set(r.x,r.y,r.z+o),n.add(h),this.scene.add(n),n},e.prototype.axisHelper=function(e){if(this.axis)e||(this.scene.remove(this.axis),this.axis=null);else if(e){var t=this.options.axisHelper;if(this.axis=new THREE.AxisHelper(t.size),t.position&&(this.axis.position.set(t.position.x,t.position.y,t.position.z),t.labels)){var i=t.size/100;this.addLabels(i)}this.scene.add(this.axis)}this.options.axisHelper.on=e},e.prototype.addControls=function(){this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.25,this.controls.enableZoom=!0,this.controls.userPanSpeed=2e4},e.prototype.addFirstPersonControls=function(){this.controls=new THREE.FirstPersonControls(this.camera,this.renderer.domElement)},e.prototype.addFlyControls=function(){this.controls=new THREE.FlyControls(this.camera,this.renderer.domElement),this.controls.movementSpeed=this.options.radius,this.controls.domElement=this.container,this.controls.rollSpeed=24*Math.PI,this.controls.autoForward=!1,this.controls.dragToLook=!1},e.prototype.addLights=function(){var e=this.options.lights;this.lights[0]=new THREE.AmbientLight(e.ambient.color),this.scene.add(this.lights[0]);var t=e.directional;this.lights[1]=new THREE.DirectionalLight(t.color),this.lights[1].position.set(t.center.x+t.position.dx,t.center.y+t.position.dy,t.center.z+t.position.dz),this.scene.add(this.lights[1]),this.lights[2]=new THREE.DirectionalLight(t.color),this.lights[2].position.set(t.center.x+t.position.dx,t.center.y+t.position.dy,t.center.z-t.position.dz),this.scene.add(this.lights[2])},e.prototype.updateLights=function(){this.scene.remove(this.lights[0]),this.scene.remove(this.lights[1]),this.scene.remove(this.lights[2]),this.addLights()},e}();e.loadBorders=x,e.loadBstones=m,e.TSurfLoader=j,e.loadPLine=y,e.loadTSurf=g,e.loadVSet=T,e.Shaders=B,e.World=N,e.CoordinateSystem=b,e.Document=V,e.PLine=L,e.PLineHeader=S,e.Properties=P,e.TSolid=A,e.TSurf=H,e.TypeFactory=D,e.Unknown=k,e.Vertex=I,e.VSet=M,e.VSetHeader=C,e.deepMerge=f,e.EventDispatcher=O,e.LinePusher=z,e.LineReader=F,e.range=v,e.parseXml=E,e.toBool=o,e.flowThru=s,e.toColor=a,e.Header=w,e.atom=n,e.vertex=r,e.Type=R,Object.defineProperty(e,"__esModule",{value:!0})});