!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Explorer3d=e.Explorer3d||{})}(this,function(e){"use strict";function t(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function r(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}c((n=n.apply(e,t)).next())})}function n(e){return e.split(/\s+/g).map(function(e){return e.replace(/\"/g,"")})}function i(e){return"true"===e}function o(e){return e}function s(e){if(e){var t=e.trim().split(/\s+/g);return 1===t.length&&0===t[0].indexOf("#")?parseInt("0x"+t[0].substring(1)):255*parseFloat(t[0])*256*256+255*parseFloat(t[1])*256+255*parseFloat(t[2])}return null}function a(e,t,r){var n=e.split(/\s+/g),i=(n.length,r?r:1),o=[],s={get xyz(){return[this.x,this.y,this.z]},get all(){var e=[this.x,this.y,this.z];return this.properties&&this.properties.forEach(function(t){e.push(t)}),e}};return n.forEach(function(e,t){switch(t){case 0:break;case 1:s.index=parseInt(e);break;case 2:o[0]=parseFloat(e);break;case 3:o[1]=parseFloat(e);break;case 4:s.z=parseFloat(e)*i;break;case 5:s.properties=[];default:s.properties.push(e)}}),t&&(o=t(o)),s.x=o[0],s.y=o[1],s}function c(e){var t=e.split(/\s+/g),r=(t.length,{get xyz(){return[this.x,this.y,this.z]}});return t.forEach(function(e,t){switch(t){case 0:break;case 1:r.index=parseInt(e);break;case 2:r.vertexId=parseFloat(e);break;case 3:r.properties=[];default:r.properties.push(e)}}),r}function u(e){var t=e.split(/\s+/g);return{id:+t[1],vertices:[+t[2],+t[3]]}}function h(e){var t=e.split(/\s+/g),r=t.length,n={get abc(){return[this.a,this.b,this.c]}};return 4===r&&(n.a=parseInt(t[1]),n.b=parseFloat(t[2]),n.c=parseFloat(t[3])),n}function d(e){var t=e.split(/\s+/g);return parseInt(t[1])}function l(e){var t=e.split(/\s+/g);return[parseInt(t[1]),parseInt(t[2])]}function p(e){var t=e.split(/\s+/g);return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3]),parseInt(t[4])]}function f(e,t){t.defs("EPSG:3112","+proj=lcc +lat_1=-18 +lat_2=-36 +lat_0=0 +lon_0=134 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs");var r=e.data.file,n=e.data.options,i=v;n&&n.from&&n.to&&n.from!==n.to&&(i=function(e,r){return function(n){return t(e,r,[n[0],n[1]])}}(n.from,n.to));r.name;return new Promise(function(e){new re(new ie(r),i).read().then(function(t){e(t)})})}function v(e){return e}function y(e){var t=e.split(/\s+/g);return{id:+t[1],vertices:[+t[2],+t[3]]}}function x(e){var t=e.split(/\s+/g),r=t.length,n={get abc(){return[this.a,this.b,this.c]}};return 4===r&&(n.a=parseInt(t[1]),n.b=parseFloat(t[2]),n.c=parseFloat(t[3])),n}function E(e){var t=e.split(/\s+/g);return parseInt(t[1])}function m(e){var t=e.split(/\s+/g);return[parseInt(t[1]),parseInt(t[2])]}function g(e){var t=e.split(/\s+/g);return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3]),parseInt(t[4])]}function w(e,t){t.defs("EPSG:3112","+proj=lcc +lat_1=-18 +lat_2=-36 +lat_0=0 +lon_0=134 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs");var r=e.data.file,n=e.data.options,i=b;n&&n.from&&n.to&&n.from!==n.to&&(i=function(e,r){return function(n){return t(e,r,[n[0],n[1]])}}(n.from,n.to));var o=(r.name,new FileReader);return new Promise(function(e){o.onload=function(t){try{new ye(new xe(t.target.result),i).read().then(function(t){e(t)})}catch(t){e(null)}},console.log(r.name),o.readAsText(r)})}function b(e){return e}function T(e,t){var r=Array.isArray(t),n=r&&[]||{};if(Array.isArray(t)){var i=n;e=e||[],i=i.concat(e),t.forEach(function(t,r){"undefined"==typeof i[r]?i[r]=t:"object"==typeof t?i[r]=T(e[r],t):e.indexOf(t)===-1&&i.push(t)})}else e&&"object"==typeof e&&Object.keys(e).forEach(function(t){n[t]=e[t]}),Object.keys(t).forEach(function(r){"object"==typeof t[r]&&t[r]&&e[r]?n[r]=T(e[r],t[r]):n[r]=t[r]});return n}function O(e,t){var r,n,i,o=-1,s=e.length;if(null==t){for(;++o<s;)if(null!=(n=e[o])&&n>=n){r=i=n;break}for(;++o<s;)null!=(n=e[o])&&(r=Math.min(r,n),i=Math.max(i,n))}else{for(;++o<s;)if(null!=(n=t(e[o],o,e))&&n>=n){r=i=n;break}for(;++o<s;)null!=(n=t(e[o],o,e))&&(r=Math.min(r,n),i=Math.max(i,n))}return[r,i]}function R(e){if("undefined"!=typeof DOMParser)return(new DOMParser).parseFromString(e,"text/xml");if("undefined"!=typeof ActiveXObject&&new ActiveXObject("Microsoft.XMLDOM")){var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}return null}function _(e){var t=new THREE.Geometry;return e.borders.forEach(function(r){var n=e.vertices[r[0]];t.vertices.push(new THREE.Vector3(n[0],n[1],n[2])),n=e.vertices[r[1]],t.vertices.push(new THREE.Vector3(n[0],n[1],n[2]))}),t.vertices.length?(t.computeBoundingBox(),new THREE.LineSegments(t,new THREE.LineBasicMaterial({linewidth:10,color:16711935}))):null}function S(e){var t=new THREE.Geometry;if(e.bstones.forEach(function(r){var n=e.vertices[r];if(n){var i=new THREE.Vector3(n[0],n[1],n[2]);t.vertices.push(i)}}),t.vertices.length){t.computeBoundingBox();var r=new THREE.PointsMaterial({size:16384});return new THREE.Points(t,r)}return null}function A(e){var t=O(e.vertices,function(e){return e?+e[3]:null}),r=new THREE.LineBasicMaterial({linewidth:10,color:16777215,vertexColors:THREE.VertexColors}),n=new THREE.Geometry,i=new THREE.Lut("rainbow",Math.floor(t[1]-t[0]));return i.setMax(Math.floor(t[1])),i.setMin(Math.floor(t[0])),e.lines.forEach(function(t){t.forEach(function(t,r){var o=e.vertices[t[0]];n.vertices.push(new THREE.Vector3(o[0],o[1],o[2])),n.colors.push(i.getColor(parseInt(o[3]))),o=e.vertices[t[1]],n.vertices.push(new THREE.Vector3(o[0],o[1],o[2])),n.colors.push(i.getColor(parseInt(o[3])))})}),n.computeBoundingBox(),n.computeBoundingSphere(),new THREE.LineSegments(n,r)}function C(e){var t=new THREE.Geometry,r=e.header.solidColor,n=new THREE.MeshLambertMaterial({color:r?r:16716049,side:THREE.DoubleSide});e.vertices.forEach(function(e){t.vertices.push(new THREE.Vector3(e[0],e[1],e[2]))}),e.faces.forEach(function(e){t.faces.push(new THREE.Face3(e[0]-1,e[1]-1,e[2]-1))}),t.computeBoundingBox(),t.computeFaceNormals();var i=new THREE.Mesh(t,n);return i}function M(e){var t=new THREE.Geometry,r=e.header.color;e.vertices.forEach(function(e){t.vertices.push(new THREE.Vector3(e[0],e[1],e[2]))});var n=new THREE.PointsMaterial({size:16,color:r}),i=new THREE.Points(t,n);return t.computeBoundingBox(),t.computeBoundingSphere(),t.computeFaceNormals(),i}var D=function(){function e(){this.isValid=!0,this.typeMap={AXIS_NAME:n,AXIS_UNIT:n}}return e}(),H=function(){function e(){}return e}(),L=function(){function e(){this.values={},this.typeMap={ivolmap:i,imap:i,parts:i,mesh:i,cn:i,border:i,"*solid*color":s}}return e}(),j=function(){function e(){this.type="Type",this.isValid=!1}return e}(),z=function(e){function r(){var t=e.apply(this,arguments)||this;return t.type="PLine",t.vertices=[],t.lines=[],t}return t(r,e),r}(j),P=function(e){function r(){return e.apply(this,arguments)||this}return t(r,e),r}(L),F=function(){function e(){this.isValid=!0,this.names={},this.range={min:null,max:null}}return e}(),I=function(e){function r(){var t=e.apply(this,arguments)||this;return t.type="TSolid",t.vertices=[],t.tetras=[],t}return t(r,e),r}(j),k=function(e){function r(){var t=e.apply(this,arguments)||this;return t.type="TSurf",t.vertices=[],t.faces=[],t.bstones=[],t.borders=[],t}return t(r,e),r}(j),V=function(){function e(){this.isValid=!1}return e}(),N=function(e){function r(){var t=e.apply(this,arguments)||this;return t.type="Unknown",t}return t(r,e),r}(j),B=function(){function e(e,t){if(e){var r=e.split(/\s+/g),n=t([parseFloat(r[0]),parseFloat(r[1])]);this.x=n[0],this.y=n[1],this.z=parseFloat(r[2])}}return e}(),G=function(e){function r(){var t=e.apply(this,arguments)||this;return t.type="VSet",t.vertices=[],t}return t(r,e),r}(j),X=function(e){function r(){return e.apply(this,arguments)||this}return t(r,e),r}(L),Z=function(){function e(e){this.reader=e}return e.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t,r,n,i,o;return __generator(this,function(s){switch(s.label){case 0:return e=new D,[4,this.reader.nextDataLine()];case 1:return t=s.sent().trim(),"GOCAD_ORIGINAL_COORDINATE_SYSTEM"===t?[3,2]:(this.reader.previous(),e.isValid=!0,[3,6]);case 2:return[4,this.reader.nextDataLine()];case 3:t=s.sent().trim(),s.label=4;case 4:return t&&"END_ORIGINAL_COORDINATE_SYSTEM"!==t?(r=t.indexOf(" "),r>0&&(n=t.substring(0,r),i=t.substring(r).trim(),o=e.typeMap[n]?e.typeMap[n]:function(e){return e},e[n]=o(i)),[4,this.reader.nextDataLine()]):[3,6];case 5:return t=s.sent().trim(),[3,4];case 6:return e.typeMap=null,[2,e]}})})},e}(),W=function(){function e(e){this.reader=e}return e.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t,r,n;return __generator(this,function(i){switch(i.label){case 0:return e=new L,[4,this.reader.nextDataLine()];case 1:t=i.sent().trim(),i.label=2;case 2:return t?0===t.indexOf("}")?[3,4]:(r=t.split(":"),2===r.length?(n=e.typeMap[r[0]],n=n?n:o,e.values[r[0]]=n(r[1])):console.warn("That doesn't look like a pair: "+t),[4,this.reader.nextDataLine()]):[3,4];case 3:return t=i.sent().trim(),[3,2];case 4:return e.name=e.values.name,e.solidColor=e.values["*solid*color"],e.solidColor=e.solidColor?e.solidColor:15658734,e.typeMap=null,[2,e]}})})},e}(),U=function(){function e(e,t){this.reader=e,this.projectionFn=t}return e.prototype.read=function(){return r(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new j]})})},e}(),q=function(e){function n(t,r){return e.call(this,t,r)||this}return t(n,e),n.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t,r,n,i,o,s,l;return __generator(this,function(p){switch(p.label){case 0:return e=new k,[4,this.reader.expects("HEADER")];case 1:return t=p.sent(),t&&t.indexOf("{")!==-1?(r=e,[4,new W(this.reader).read()]):[2,e];case 2:return r.header=p.sent(),[4,new Z(this.reader).read()];case 3:return n=p.sent(),i=1,n.isValid&&(e.coordinateSystem=n,i="Depth"===e.coordinateSystem.ZPOSITIVE?-1:1),[4,this.reader.expects("TFACE")];case 4:t=p.sent(),p.label=5;case 5:return[4,this.reader.nextDataLine()];case 6:return"END"===(t=p.sent().trim())?[3,7]:(0===t.indexOf("VRTX")||0===t.indexOf("PVRTX")?(o=a(t,this.projectionFn,i),e.vertices[o.index]=o.all):0===t.indexOf("ATOM")||0===t.indexOf("PATOM")?(s=c(t),e.vertices[s.index]=e.vertices[s.vertexId]):0===t.indexOf("TRGL")?e.faces.push(h(t).abc):0===t.indexOf("BSTONE")?e.bstones.push(d(t)):0===t.indexOf("BORDER")&&(l=u(t),e.borders[l.id]=[l.vertices[0],l.vertices[1]]),[3,5]);case 7:return[2,e]}})})},n}(U),K=function(e){function n(t){return e.call(this,t)||this}return t(n,e),n.prototype.read=function(){return r(this,void 0,void 0,function(){var t,r,n;return __generator(this,function(i){switch(i.label){case 0:return[4,e.prototype.read.call(this)];case 1:return t=i.sent(),r=Object.assign(new P,t),r.paintedVariable=r.values["*painted*variable"],n=r.values["*line*color"],r.color=n?s(n):255,[2,r]}})})},n}(W),Y=function(e){function n(t,r){return e.call(this,t,r)||this}return t(n,e),n.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t,r,n,i,o,s,u,h,d,p,f,v;return __generator(this,function(y){switch(y.label){case 0:return e=new z,[4,this.reader.expects("HEADER")];case 1:return t=y.sent(),t&&t.indexOf("{")!==-1?[4,new K(this.reader).read()]:[2,e];case 2:return r=y.sent(),e.header=r,[4,new Z(this.reader).read()];case 3:return n=y.sent(),i=1,n.isValid&&(e.coordinateSystem=n,i="Depth"===e.coordinateSystem.ZPOSITIVE?-1:1),[4,this.reader.expects("ILINE")];case 4:return t=y.sent(),o=1,s=1,u=!1,h=[],[4,this.reader.nextDataLine()];case 5:t=y.sent(),d="}"===(t?t.trim():"}"),y.label=6;case 6:if(d)return[3,9];if(0===t.indexOf("VRTX")||0===t.indexOf("PVRTX"))p=a(t,this.projectionFn,i),e.vertices[p.index]=p.all,s=p.index;else if(0===t.indexOf("ATOM")||0===t.indexOf("PATOM"))f=c(t),e.vertices[f.index]=e.vertices[f.vertexId];else if(0===t.indexOf("SEG"))h.push(l(t)),u=!0;else if(0===t.indexOf("ILINE")||0===t.indexOf("END")){if(d=0===t.indexOf("END"),!u&&s>o)for(v=o;v<s;v++)h.push([v,v+1]);e.lines.push(h),h=[],o=s+1,u=!1}return d=!this.reader.hasMore(),d?[3,8]:[4,this.reader.nextDataLine()];case 7:t=y.sent().trim(),d="}"===t,y.label=8;case 8:return[3,6];case 9:return[2,e]}})})},n}(U),J=function(){function e(e,t){this.reader=e,this.projectionFn=t}return e.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t,r,n,i,o,s,u;return __generator(this,function(h){switch(h.label){case 0:return e=new I,[4,new U(this.reader,this.projectionFn).read()];case 1:return t=h.sent(),[4,this.reader.expects("HEADER")];case 2:return(r=h.sent())?(n=e,[4,new W(this.reader).read()]):[3,8];case 3:return n.header=h.sent(),[4,new Z(this.reader).read()];case 4:return i=h.sent(),o=1,i.isValid&&(e.coordinateSystem=i,o="Depth"===e.coordinateSystem.ZPOSITIVE?-1:1),[4,this.reader.expects("TVOLUME")];case 5:r=h.sent(),h.label=6;case 6:return[4,this.reader.nextDataLine()];case 7:return"END"===(r=h.sent().trim())?[3,8]:(0===r.indexOf("VRTX")||0===r.indexOf("PVRTX")?(s=a(r,this.projectionFn,o),e.vertices[s.index]=s.all):0===r.indexOf("ATOM")||0===r.indexOf("PATOM")?(u=c(r),e.vertices[u.index]=e.vertices[u.vertexId]):0===r.indexOf("TETRA")&&e.tetras.push(p(r)),[3,6]);case 8:return[2,e]}})})},e}(),Q=function(){function e(e){this.reader=e}return e.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t;return __generator(this,function(r){switch(r.label){case 0:return[4,new W(this.reader).read()];case 1:return e=r.sent(),t=Object.assign(new X,e),t.color=s(t.values["*atoms*color"]),[2,t]}})})},e}(),$=function(){function e(e,t){this.reader=e,this.projectionFn=t}return e.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t,r,n,i,o,s;return __generator(this,function(u){switch(u.label){case 0:return e=new G,[4,this.reader.expects("HEADER")];case 1:return t=u.sent(),t&&t.indexOf("{")!==-1?(r=e,[4,new Q(this.reader).read()]):[2];case 2:return r.header=u.sent(),[4,new Z(this.reader).read()];case 3:n=u.sent(),i=1,n.isValid&&(e.coordinateSystem=n,i="Depth"===e.coordinateSystem.ZPOSITIVE?-1:1),u.label=4;case 4:return[4,this.reader.nextDataLine()];case 5:return"END"===(t=u.sent().trim())?[3,6]:(0===t.indexOf("VRTX")||0===t.indexOf("PVRTX")?(o=a(t,this.projectionFn,i),e.vertices[o.index]=o.all):0!==t.indexOf("ATOM")&&0!==t.indexOf("PATOM")||(s=c(t),e.vertices[s.index]=e.vertices[s.vertexId]),[3,4]);case 6:return[2,e]}})})},e}(),ee=function(){function e(e,t){this.reader=e,this.projectionFn=t}return e.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t;return __generator(this,function(r){switch(r.label){case 0:e=new N,r.label=1;case 1:return this.reader.hasMore()?[4,this.reader.next()]:[3,3];case 2:return t=r.sent().trim(),"END"===t?[3,3]:[3,1];case 3:return[2,e]}})})},e}(),te=function(){function e(e,t){this.reader=e,this.projectionFn=t}return e.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t,r,n,i,o,s,a;return __generator(this,function(c){switch(c.label){case 0:return e=new V,this.reader.hasMore()?[4,this.reader.next()]:[3,11];case 1:return t=c.sent().trim(),r=t.split(/\s+/g),e.isValid=3===r.length&&"GOCAD"===r[0]&&("1.0"===r[2]||"1"===r[2]),e.isValid?(e.version=r[2],"TSurf"!==r[1]?[3,3]:(n=e,[4,new q(this.reader,this.projectionFn).read()])):[3,11];case 2:return n.type=c.sent(),[3,11];case 3:return"PLine"!==r[1]?[3,5]:(i=e,[4,new Y(this.reader,this.projectionFn).read()]);case 4:return i.type=c.sent(),[3,11];case 5:return"TSolid"!==r[1]?[3,7]:(o=e,[4,new J(this.reader,this.projectionFn).read()]);case 6:return o.type=c.sent(),[3,11];case 7:return"VSet"!==r[1]?[3,9]:(s=e,[4,new $(this.reader,this.projectionFn).read()]);case 8:return s.type=c.sent(),[3,11];case 9:return a=e,[4,new ee(this.reader,this.projectionFn).read()];case 10:a.type=c.sent(),c.label=11;case 11:return[2,e]}})})},e}(),re=function(){function e(e,t){this.reader=e,this.projectionFn=t,this.document=new H}return e.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t;return __generator(this,function(r){switch(r.label){case 0:return this.document.types=[],this.reader.hasMore()?(e=new te(this.reader,this.projectionFn),[4,e.read()]):[3,2];case 1:t=r.sent(),t.isValid&&this.document.types.push(t.type),r.label=2;case 2:return[2,this.document]}})})},e}(),ne=function(){function e(e){this.PAGE_SIZE=1048576,this.file=e,this.length=e.size,this.pageNo=0,this.index=this.PAGE_SIZE}return e.prototype.readPage=function(){return r(this,void 0,void 0,function(){var e,t,r,n=this;return __generator(this,function(i){return e=this.pageNo*this.PAGE_SIZE,e>=this.length?[2,""]:(t=new FileReader,r=this.file.slice(e,e+this.PAGE_SIZE),t.readAsText(r),[2,new Promise(function(e){t.onloadend=function(t){t.target.readyState===FileReader.prototype.DONE&&(console.log("Reading page "+n.pageNo),n.buffer=t.target.result,n.pageNo++,n.index=0,console.log("read"),e(!0))}})])})})},e.prototype.hasMore=function(){return this.index+this.PAGE_SIZE*this.pageNo<this.length-1},e.prototype.next=function(){return r(this,void 0,void 0,function(){var e,t;return __generator(this,function(r){switch(r.label){case 0:e=[],r.label=1;case 1:return this.hasMore()?this.index>=this.PAGE_SIZE?[4,this.readPage()]:[3,3]:[3,4];case 2:r.sent(),r.label=3;case 3:return t=this.buffer[this.index],"\r"===t?[3,1]:"\n"===t?(this.index++,[3,4]):(e.push(t),[3,1]);case 4:return[2,e.join("")]}})})},e}(),ie=function(){function e(e){this.streamer=new ne(e),this.current=""}return e.prototype.hasMore=function(){return this.streamer.hasMore()},e.prototype.previous=function(){this.useLast=!0},e.prototype.next=function(){return r(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.useLast?(this.useLast=!1,[2,this.current]):(e=this,[4,this.streamer.next()]);case 1:return e.current=t.sent(),[2,this.current]}})})},e.prototype.expects=function(e){return r(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return this.hasMore()?[4,this.next()]:[3,2];case 1:return t=r.sent(),t.indexOf(e)?[3,0]:[2,t];case 2:return[2,null]}})})},e.prototype.nextNonEmpty=function(){return r(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.hasMore()?[4,this.next()]:[3,2];case 1:return e=t.sent(),e?[2,e]:[3,0];case 2:return[2,null]}})})},e.prototype.nextDataLine=function(){return r(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.nextNonEmpty()];case 1:e=t.sent(),t.label=2;case 2:return e?e.indexOf("#")?[2,e]:[4,this.nextNonEmpty()]:[3,4];case 3:return e=t.sent(),[3,2];case 4:return[2,e]}})})},e}(),oe=function(){function e(e){this.reader=e}return e.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t,r,n,i,o;return __generator(this,function(s){if(e=new D,t=this.reader.nextDataLine().trim(),"GOCAD_ORIGINAL_COORDINATE_SYSTEM"!==t)this.reader.previous(),e.isValid=!1;else for(t=this.reader.nextDataLine().trim();t&&"END_ORIGINAL_COORDINATE_SYSTEM"!==t;)r=t.indexOf(" "),r>0&&(n=t.substring(0,r),i=t.substring(r).trim(),o=e.typeMap[n]?e.typeMap[n]:function(e){return e},e[n]=o(i)),t=this.reader.nextDataLine().trim();return e.typeMap=null,[2,e]})})},e}(),se=function(){function e(e){this.reader=e}return e.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t,r,n;return __generator(this,function(i){for(e=new L,t=this.reader.nextDataLine().trim();t&&0!==t.indexOf("}");)r=t.split(":"),2===r.length?(n=e.typeMap[r[0]],n=n?n:o,e.values[r[0]]=n(r[1])):console.warn("That doesn't look like a pair: "+t),t=this.reader.nextDataLine().trim();return e.name=e.values.name,e.solidColor=e.values["*solid*color"],e.solidColor=e.solidColor?e.solidColor:15658734,e.typeMap=null,[2,e]})})},e}(),ae=function(){function e(e,t){this.reader=e,this.projectionFn=t}return e.prototype.read=function(){return r(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e){var t=new j;e(t)})]})})},e}(),ce=function(e){function n(t,r){return e.call(this,t,r)||this}return t(n,e),n.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t,r,n,i,o,s,u;return __generator(this,function(h){switch(h.label){case 0:return e=new k,t=this.reader.expects("HEADER"),t&&t.indexOf("{")!==-1?(r=e,[4,new se(this.reader).read()]):[2,new Promise(function(t){return e})];case 1:return r.header=h.sent(),[4,new oe(this.reader).read()];case 2:for(n=h.sent(),i=1,n.isValid&&(e.coordinateSystem=n,i="Depth"===e.coordinateSystem.ZPOSITIVE?-1:1),t=this.reader.expects("TFACE");"END"!==(t=this.reader.nextDataLine().trim());)0===t.indexOf("VRTX")||0===t.indexOf("PVRTX")?(o=a(t,this.projectionFn,i),e.vertices[o.index]=o.all):0===t.indexOf("ATOM")||0===t.indexOf("PATOM")?(s=c(t),e.vertices[s.index]=e.vertices[s.vertexId]):0===t.indexOf("TRGL")?e.faces.push(x(t).abc):0===t.indexOf("BSTONE")?e.bstones.push(E(t)):0===t.indexOf("BORDER")&&(u=y(t),e.borders[u.id]=[u.vertices[0],u.vertices[1]]);return[2,e]}})})},n}(ae),ue=function(e){function n(t){return e.call(this,t)||this}return t(n,e),n.prototype.read=function(){return r(this,void 0,void 0,function(){var t,r,n;return __generator(this,function(i){switch(i.label){case 0:return[4,e.prototype.read.call(this)];case 1:return t=i.sent(),r=Object.assign(new P,t),r.paintedVariable=r.values["*painted*variable"],n=r.values["*line*color"],r.color=n?s(n):255,[2,r]}})})},n}(se),he=function(e){function n(t,r){return e.call(this,t,r)||this}return t(n,e),n.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t,r,n,i,o,s,u,h,d,l,p,f;return __generator(this,function(v){switch(v.label){case 0:return e=new z,t=this.reader.expects("HEADER"),t&&t.indexOf("{")!==-1?[4,new ue(this.reader).read()]:[2,new Promise(function(t){t(e)})];case 1:return r=v.sent(),e.header=r,[4,new oe(this.reader).read()];case 2:for(n=v.sent(),i=1,n.isValid&&(e.coordinateSystem=n,i="Depth"===e.coordinateSystem.ZPOSITIVE?-1:1),t=this.reader.expects("ILINE"),o=1,s=1,u=!1,h=[],t=this.reader.nextDataLine(),d="}"===(t?t.trim():"}");!d;){if(0===t.indexOf("VRTX")||0===t.indexOf("PVRTX"))l=a(t,e.projectionFn,i),e.vertices[l.index]=l.all,s=l.index;else if(0===t.indexOf("ATOM")||0===t.indexOf("PATOM"))p=c(t),e.vertices[p.index]=e.vertices[p.vertexId];else if(0===t.indexOf("SEG"))h.push(m(t)),u=!0;else if(0===t.indexOf("ILINE")||0===t.indexOf("END")){if(d=0===t.indexOf("END"),!u&&s>o)for(f=o;f<s;f++)h.push([f,f+1]);e.lines.push(h),h=[],o=s+1,u=!1}d=!this.reader.hasMore(),d||(d="}"===(t=this.reader.nextDataLine().trim()))}return[2,e]}})})},n}(ae),de=function(){function e(e,t){this.reader=e,this.projectionFn=t}return e.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t,r,n,i,o,s,u;return __generator(this,function(h){switch(h.label){case 0:return e=new I,[4,new ae(this.reader,this.projectionFn).read()];case 1:return t=h.sent(),(r=this.reader.expects("HEADER"))?(n=e,[4,new se(this.reader).read()]):[3,4];case 2:return n.header=h.sent(),[4,new oe(this.reader).read()];case 3:for(i=h.sent(),o=1,i.isValid&&(e.coordinateSystem=i,o="Depth"===e.coordinateSystem.ZPOSITIVE?-1:1),r=this.reader.expects("TVOLUME");"END"!==(r=this.reader.nextDataLine().trim());)0===r.indexOf("VRTX")||0===r.indexOf("PVRTX")?(s=a(r,this.projectionFn,o),e.vertices[s.index]=s.all):0===r.indexOf("ATOM")||0===r.indexOf("PATOM")?(u=c(r),e.vertices[u.index]=e.vertices[u.vertexId]):0===r.indexOf("TETRA")&&e.tetras.push(g(r));h.label=4;case 4:return[2,e]}})})},e}(),le=function(){function e(e){this.reader=e}return e.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t;return __generator(this,function(r){switch(r.label){case 0:return[4,new se(this.reader).read()];case 1:return e=r.sent(),t=Object.assign(new X,e),t.color=s(t.values["*atoms*color"]),[2,t]}})})},e}(),pe=function(){function e(e,t){this.reader=e,this.projectionFn=t}return e.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t,r,n,i,o,s;return __generator(this,function(u){switch(u.label){case 0:return e=new G,t=this.reader.expects("HEADER"),t&&t.indexOf("{")!==-1?(r=e,[4,new le(this.reader).read()]):[2];case 1:return r.header=u.sent(),[4,new oe(this.reader).read()];case 2:for(n=u.sent(),i=1,n.isValid&&(e.coordinateSystem=n,i="Depth"===e.coordinateSystem.ZPOSITIVE?-1:1);"END"!==(t=this.reader.nextDataLine().trim());)0===t.indexOf("VRTX")||0===t.indexOf("PVRTX")?(o=a(t,this.projectionFn,i),e.vertices[o.index]=o.all):0!==t.indexOf("ATOM")&&0!==t.indexOf("PATOM")||(s=c(t),e.vertices[s.index]=e.vertices[s.vertexId]);return[2,e]}})})},e}(),fe=function(){function e(e,t){this.reader=e,this.projectionFn=t}return e.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t;return __generator(this,function(r){for(e=new N;this.reader.hasMore()&&(t=this.reader.next().trim(),"END"!==t););return[2,new Promise(function(t){t(e)})]})})},e}(),ve=function(){function e(e,t){this.reader=e,this.projectionFn=t}return e.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t,r,n,i,o,s,a;return __generator(this,function(c){switch(c.label){case 0:return e=new V,this.reader.hasMore()?(t=this.reader.next().trim(),r=t.split(/\s+/g),e.isValid=3===r.length&&"GOCAD"===r[0]&&("1.0"===r[2]||"1"===r[2]),e.isValid?(e.version=r[2],"TSurf"!==r[1]?[3,2]:(n=e,[4,new ce(this.reader,this.projectionFn).read()])):[3,10]):[3,10];case 1:return n.type=c.sent(),[3,10];case 2:return"PLine"!==r[1]?[3,4]:(i=e,[4,new he(this.reader,this.projectionFn).read()]);case 3:return i.type=c.sent(),[3,10];case 4:return"TSolid"!==r[1]?[3,6]:(o=e,[4,new de(this.reader,this.projectionFn).read()]);case 5:return o.type=c.sent(),[3,10];case 6:return"VSet"!==r[1]?[3,8]:(s=e,[4,new pe(this.reader,this.projectionFn).read()]);case 7:return s.type=c.sent(),[3,10];case 8:return a=e,[4,new fe(this.reader,this.projectionFn).read()];case 9:a.type=c.sent(),c.label=10;case 10:return[2,e]}})})},e}(),ye=function(){function e(e,t){this.reader=e,this.projectionFn=t,this.document=new H}return e.prototype.read=function(){return r(this,void 0,void 0,function(){var e,t;return __generator(this,function(r){switch(r.label){case 0:return this.document.types=[],this.reader.hasMore()?(e=new ve(this.reader,this.projectionFn),[4,e.read()]):[3,2];case 1:t=r.sent(),t.isValid&&this.document.types.push(t.type),r.label=2;case 2:return[2,this.document]}})})},e}(),xe=function(){function e(e){this.indexStack=[],this.data=e,this.length=e.length,this.index=0}return e.prototype.hasMore=function(){return this.index<this.length-1},e.prototype.peek=function(){this.next();this.previous()},e.prototype.previous=function(){this.indexStack.length&&(this.index=this.indexStack.pop())},e.prototype.next=function(){this.indexStack.push(this.index);for(var e=[];this.index<this.length;this.index++){var t=this.data[this.index];if("\r"!==t){if("\n"===t){this.index++;break}e.push(this.data[this.index])}}return e?e.join(""):null},e.prototype.expects=function(e){for(;this.hasMore();){var t=this.next();if(!t.indexOf(e))return t}return null},e.prototype.nextNonEmpty=function(){for(;this.hasMore();){var e=this.next();if(e)return e}return null},e.prototype.nextDataLine=function(){for(var e=this.nextNonEmpty();e;){if(e.indexOf("#"))return e;e=this.nextNonEmpty()}return e},e}(),Ee=function(){function e(){}return e.prototype.apply=function(t){t.addEventListener=e.prototype.addEventListener,t.hasEventListener=e.prototype.hasEventListener,t.removeEventListener=e.prototype.removeEventListener,t.dispatchEvent=e.prototype.dispatchEvent},e.prototype.addEventListener=function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)},e.prototype.hasEventListener=function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&r[e].indexOf(t)!==-1},e.prototype.removeEventListener=function(e,t){if(void 0!==this._listeners){var r=this._listeners,n=r[e];if(void 0!==n){var i=n.indexOf(t);i!==-1&&n.splice(i,1)}}},e.prototype.dispatchEvent=function(){},e}(),me=function(){function e(e,t,r){this.PAGE_SIZE=1048576,this.file=e,this.length=e.size,this.handler=t,this.errorHandler=r,this.pageNo=this.index=0,this.lineBuffer=[],this.process()}return e.prototype.process=function(){this.readPage()},e.prototype.readPage=function(){function e(e){for(var t=0;t<e.length;t++){var r=e[this.index];"\r"!==r&&("\n"!==r?this.lineBuffer.push(e[t]):(this.handler(this.lineBuffer.join("")),this.lineBuffer=[]))}}var t=this,r=this.pageNo*this.PAGE_SIZE;r>=this.length&&this.complete();var n=new FileReader,i=this.file.slice(r,r+this.PAGE_SIZE);n.onloadend=function(r){if(r.target.readyState===FileReader.prototype.DONE){var n=r.target.result;e(n),t.pageNo++,t.readPage()}},n.readAsText(i)},e.prototype.complete=function(){this.lineBuffer.length&&this.handler(this.lineBuffer.join("")),this.handler(null)},e}(),ge=function(){function e(){this.geometry=new THREE.Geometry,this.userData={}}return e.prototype.setHeader=function(e){this.userData.header=e;var t=e.solidColor;this.material=new THREE.MeshLambertMaterial({color:t?t:16716049,side:THREE.DoubleSide})},e.prototype.setVertices=function(e){var t=this;e.forEach(function(e){t.geometry.vertices.push(new THREE.Vector3(e[0],e[1],e[2]))})},e.prototype.setCoordinateSystem=function(e){this.userData.coordinateSystem=e},e.prototype.setFaces=function(e){var t=this;e.forEach(function(e){t.geometry.faces.push(new THREE.Face3(e[0]-1,e[1]-1,e[2]-1))})},e.prototype.createMesh=function(){this.geometry.computeBoundingBox(),this.geometry.computeFaceNormals();var e=new THREE.Mesh(this.geometry,this.material);return e.userData=this.userData,e},e}(),we=function(){function e(){}return e.add=function(e,t){return t=t?t:{},t.vertexShader=this.VertexShader[e],t.fragmentShader=this.FragmentShader[e],t},e}();we.VertexShader={COLOR_RAMP:"attribute vec3 customColor;\nvarying vec3 vColor;\nvoid main() {\n\tvColor = customColor;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},we.FragmentShader={COLOR_RAMP:"uniform vec3 color;\n\nvarying vec3 vColor;\nvoid main() {\n\tgl_FragColor = vec4( vColor * color, 1 );\n}"};var be=function(){function e(e,t){function r(){a.continueAnimation&&(window.requestAnimationFrame(r),a.camera.lookAt(a.lookAt),a.renderer.render(a.scene,a.camera),a.controls.update(.02))}void 0===t&&(t={}),this.options={camera:{fov:45,near:.1,far:5e5,position:{x:-30,y:40,z:30},up:{x:0,y:1,z:0}},lights:{ambient:{color:5592405},directional:{color:10526880,center:{x:0,y:0,z:0},position:{dx:50,dy:10,dz:-300}}},axisHelper:{on:!0,size:20}},this.lights=[],this.options=T(this.options,t);var n=document.body.getBoundingClientRect();"string"==typeof e?this.container=document.getElementById(""+e):this.container=e,this.scene=new THREE.Scene,this.renderer=new THREE.WebGLRenderer({clearColor:16711680}),this.renderer.setSize(n.width,n.height);var i=this.options.camera;this.camera=new THREE.PerspectiveCamera(i.fov,n.width/n.height,i.near,i.far),this.camera.up.set(i.up.x,i.up.y,i.up.z);var o=i.position;if(this.camera.position.x=o.x,this.camera.position.y=o.y,this.camera.position.z=o.z,t.camera.lookAt){var s=t.camera.lookAt;this.lookAt=new THREE.Vector3(s.x,s.y,s.z)}else this.lookAt=this.scene.position;this.camera.lookAt(this.lookAt),this.container.appendChild(this.renderer.domElement),this.renderer.render(this.scene,this.camera),this.axisHelper(this.options.axisHelper.on),this.addLights(),this.addFlyControls(),this.resizer=THREEExt.WindowResize(this.renderer,this.camera,this.container);var a=this;this.continueAnimation=!0,this.resizer.trigger(),r()}return e.prototype.destroy=function(){for(this.lights=[],
this.axis=null,this.renderer.dispose(),this.renderer=null,this.dataContainer.children.forEach(function(e){e.geometry.dispose(),e.material.dispose()}),this.scene.remove(this.dataContainer),this.scene=null,this.camera=null,this.controls.dispose&&this.controls.dispose(),this.controls=null,this.resizer.destroy(),this.resizer=null;this.container.lastChild;)this.container.removeChild(this.container.lastChild);this.continueAnimation=!1},e.prototype.resize=function(e){this.options=T(this.options,e?e:{});var t=this.options.axisHelper.on;this.axisHelper(!1),this.axisHelper(t),this.updateLights();var r=e.camera.lookAt;this.lookAt=new THREE.Vector3(r.x,r.y,r.z),this.camera.far=e.camera.far,this.camera.near=e.camera.near,this.camera.lookAt(this.lookAt)},e.prototype.update=function(e){this.options=T(this.options,e?e:{});var t=this.options.camera;this.camera.up.set(t.up.x,t.up.y,t.up.z);var r=t.position;if(this.camera.position.x=r.x,this.camera.position.y=r.y,this.camera.position.z=r.z,e.camera.lookAt){var n=e.camera.lookAt;this.lookAt=new THREE.Vector3(n.x,n.y,n.z)}else this.lookAt=this.scene.position;this.camera.lookAt(this.lookAt),this.controls.movementSpeed=this.options.radius;var i=this.options.axisHelper.on;this.axisHelper(!1),this.axisHelper(i),this.updateLights()},e.prototype.addLabels=function(e){function t(t,n){var i=T({fontface:"Arial",fontsize:18,borderThickness:4,borderColor:{r:0,g:0,b:0,a:1},backgroundColor:{r:255,g:255,b:255,a:1}},n?n:{}),o=document.createElement("canvas"),s=o.getContext("2d");s.font=i.fontsize+"px "+i.fontface;var a=s.measureText(t),c=a.width;s.fillStyle="rgba("+i.backgroundColor.r+","+i.backgroundColor.g+","+i.backgroundColor.b+","+i.backgroundColor.a+")",s.strokeStyle="rgba("+i.borderColor.r+","+i.borderColor.g+","+i.borderColor.b+","+i.borderColor.a+")",s.lineWidth=i.borderThickness,r(s,i.borderThickness/2,i.borderThickness/2,c+i.borderThickness,1.4*i.fontsize+i.borderThickness,6),s.fillStyle="rgba(0, 0, 0, 1.0)",s.fillText(t,i.borderThickness,i.fontsize+i.borderThickness);var u=new THREE.Texture(o);u.needsUpdate=!0;var h=new THREE.SpriteMaterial({map:u}),d=new THREE.Sprite(h);return d.scale.set(35*e,15*e,1),d}function r(e,t,r,n,i,o){e.beginPath(),e.moveTo(t+o,r),e.lineTo(t+n-o,r),e.quadraticCurveTo(t+n,r,t+n,r+o),e.lineTo(t+n,r+i-o),e.quadraticCurveTo(t+n,r+i,t+n-o,r+i),e.lineTo(t+o,r+i),e.quadraticCurveTo(t,r+i,t,r+i-o),e.lineTo(t,r+o),e.quadraticCurveTo(t,r,t+o,r),e.closePath(),e.fill(),e.stroke()}this.labels&&this.scene.remove(this.labels);var n=this.labels=new THREE.Object3D,i=this.options.axisHelper.position,o=this.options.axisHelper.size,s=this.options.axisHelper.labels,a={fontsize:64,backgroundColor:{r:255,g:200,b:200,a:.7}},c=t(s.x,a);return c.position.set(i.x+o,i.y,i.z),n.add(c),a.backgroundColor={r:200,g:255,b:200,a:.7},c=t(s.y,a),c.position.set(i.x,i.y+o,i.z),n.add(c),a.backgroundColor={r:200,g:200,b:255,a:.7},c=t(s.z,a),c.position.set(i.x,i.y,i.z+o),n.add(c),this.scene.add(n),n},e.prototype.axisHelper=function(e){if(this.axis)e||(this.scene.remove(this.axis),this.axis=null);else if(e){var t=this.options.axisHelper;if(this.axis=new THREE.AxisHelper(t.size),t.position&&(this.axis.position.set(t.position.x,t.position.y,t.position.z),t.labels)){var r=t.size/100;this.addLabels(r)}this.scene.add(this.axis)}this.options.axisHelper.on=e},e.prototype.addControls=function(){this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.25,this.controls.enableZoom=!0,this.controls.userPanSpeed=2e4},e.prototype.addFirstPersonControls=function(){this.controls=new THREE.FirstPersonControls(this.camera,this.renderer.domElement)},e.prototype.addFlyControls=function(){this.controls=new THREE.FlyControls(this.camera,this.renderer.domElement),this.controls.movementSpeed=this.options.radius,this.controls.domElement=this.container,this.controls.rollSpeed=24*Math.PI,this.controls.autoForward=!1,this.controls.dragToLook=!1},e.prototype.addLights=function(){var e=this.options.lights;this.lights[0]=new THREE.AmbientLight(e.ambient.color),this.scene.add(this.lights[0]);var t=e.directional;this.lights[1]=new THREE.DirectionalLight(t.color),this.lights[1].position.set(t.center.x+t.position.dx,t.center.y+t.position.dy,t.center.z+t.position.dz),this.scene.add(this.lights[1]),this.lights[2]=new THREE.DirectionalLight(t.color),this.lights[2].position.set(t.center.x+t.position.dx,t.center.y+t.position.dy,t.center.z-t.position.dz),this.scene.add(this.lights[2])},e.prototype.updateLights=function(){this.scene.remove(this.lights[0]),this.scene.remove(this.lights[1]),this.scene.remove(this.lights[2]),this.addLights()},e}(),Te=function(e){function r(t){var r=e.call(this)||this;return r.element=t,r.state={world:null,dataContainer:null,get isAllVisible(){if(this.state.world&&this.state.world.scene)return!this.state.dataContainer.children.some(function(e){return!e.visible})}},r}return t(r,e),r.prototype.destroy=function(){this.state.world&&(this.state.world.destroy(),this.state.world=null,this.state.dataContainer=null,this.dispatchEvent({type:"objects.changed",objects:[]}))},r.prototype.remove=function(e){var t=!1;return this.state.dataContainer&&(this.state.dataContainer.remove(e),t=this.state.dataContainer.children.length>0,t?(this.resize(),this.dispatchEvent({type:"objects.changed",objects:this.state.dataContainer.children})):this.destroy()),t},r.prototype.resize=function(){var e=(new THREE.Box3).setFromObject(this.state.dataContainer),t=e.getCenter(),r=e.getBoundingSphere().radius,n=2.5*r,i={radius:r,axisHelper:{on:!0,size:r,position:{x:t.x,y:t.y,z:t.z},labels:{x:" East ",y:" North ",z:" Elevation "}},camera:{far:250*n,near:.01*r,lookAt:{x:t.x,y:t.y,z:t.z}},lights:{directional:{center:{x:t.x,y:t.y,z:t.z},position:{dx:r,dy:-r,dz:n}}}};this.state.world.resize(i)},r.prototype.show=function(e){this.state.dataContainer?this.extend(e):this.create(e),this.dispatchEvent({type:"objects.changed",objects:this.state.dataContainer.children})},r.prototype.create=function(e){this.state.dataContainer=new THREE.Object3D,this.state.dataContainer.add(e);var t=(new THREE.Box3).setFromObject(e),r=t.getCenter();e.userData.center=r;var n=t.getBoundingSphere().radius,i=4*n,o={radius:n,axisHelper:{on:!0,size:n,position:{x:r.x,y:r.y,z:r.z},labels:{x:" East ",y:" North ",z:" Elevation "}},camera:{far:250*i,near:.01*n,up:{x:0,y:0,z:1},position:{x:r.x,y:r.y-3*n,z:r.z+n},lookAt:{x:r.x,y:r.y,z:r.z}},lights:{directional:{center:{x:r.x,y:r.y,z:r.z},position:{dx:n,dy:n,dz:i}}}};this.state.world&&this.state.world.destroy(),this.state.world=new be(this.element,o),this.add(this.state.dataContainer),this.dispatchEvent({type:"world.created",factory:this})},r.prototype.getWorld=function(){return this.state.world},r.prototype.add=function(e){this.state.world.scene.add(e),this.state.world.dataContainer=e},r.prototype.extend=function(e){var t=(new THREE.Box3).setFromObject(e).getCenter();e.userData.center=t,this.state.dataContainer.add(e);var r=(new THREE.Box3).setFromObject(this.state.dataContainer);t=r.getCenter();var n=r.getBoundingSphere().radius,i=4*n,o={radius:n,axisHelper:{on:!0,size:n,position:{x:t.x,y:t.y,z:t.z},labels:{x:" East ",y:" North ",z:" Elevation "}},camera:{far:250*i,near:.01*n,up:{x:0,y:0,z:1},position:{x:t.x,y:t.y-3*n,z:t.z+n},lookAt:{x:t.x,y:t.y,z:t.z}},lights:{directional:{center:{x:t.x,y:t.y,z:t.z},position:{dx:n,dy:-n,dz:i}}}};this.state.world.update(o)},r}(THREE.EventDispatcher),Oe=function(){function e(e){var t=this;this.eventdispatcher=e,this.callbacks=[],e.addEventListener("world.created",function(e){t.factory=e.factory,t.flushCallbacks(e.factory)}),e.addEventListener("world.destroyed",function(e){t.factory=null,t.flushCallbacks(null)})}return e.prototype.flushCallbacks=function(e){this.callbacks&&(this.callbacks.forEach(function(t){t(e)}),this.callbacks=[])},e.prototype.onChange=function(e){var t=this;return setTimeout(function(){return e(t.factory)}),this.callbacks.push(e),this},e}(),Re=function(e){function r(){return e.apply(this,arguments)||this}return t(r,e),r.prototype.set=function(e){e?this.on():this.off()},r.prototype.on=function(){this.factory&&this.factory.getWorld()&&(this.factory.getWorld().labels.visible=!0)},r.prototype.off=function(){this.factory&&this.factory.getWorld()&&(this.factory.getWorld().labels.visible=!1)},r}(Oe),_e=function(e){function r(){return e.apply(this,arguments)||this}return t(r,e),r.prototype.set=function(e){this.factory&&this.factory.getWorld()&&(this.factory.getWorld().dataContainer.scale.z=e)},r}(Oe),Se=function(){function e(e,t){function r(e){e.stopPropagation(),e.preventDefault()}function n(e){e.stopPropagation(),e.preventDefault()}function i(e){e.stopPropagation(),e.preventDefault();var t=e.dataTransfer,r=t.files;o(r)}function o(e){if(e)for(var r=0;r<e.length;r++)t(e.item(r))}if(!t||"function"!=typeof t)throw Error("No file handler provided");if(!e)throw Error("No element provided");e.addEventListener("dragenter",r,!1),e.addEventListener("dragover",n,!1),e.addEventListener("drop",i,!1)}return e}(),Ae=function(){function e(){}return e.prototype.getBase=function(){return e.workerBase},e}();Ae.workerBase="";var Ce=function(){function e(){}return e.transform=function(e){var t;return e.types?(e.types.forEach(function(e){"TSurf"===e.type?t=C(e):"PLine"===e.type?t=A(e):"VSet"===e.type&&(t=M(e))}),t.userData={header:e.types[0].header,coordinateSystem:e.types[0].coordinateSystem},t):null},e}(),Me=(function(e){function r(){return e.apply(this,arguments)||this}return t(r,e),r}(THREE.Object3D),function(e){function r(){return e.apply(this,arguments)||this}return t(r,e),r.prototype.parse=function(e,t){var n=this;return new Promise(function(t){var i=new Worker(n.getBase()+r.WORKER_NAME);i.addEventListener("message",function(e){console.log("worker gocadstream.js finished"),t(e.data)}),i.postMessage(e)})},r}(Ae));Me.WORKER_NAME="gocadstream.js";var De=function(e){function r(){return e.apply(this,arguments)||this}return t(r,e),r.prototype.parse=function(e,t){var n=this;return new Promise(function(t){var i=new Worker(n.getBase()+r.WORKER_NAME);i.addEventListener("message",function(e){console.log("worker geojson.js finished"),t(e.data)}),i.postMessage(e)})},r}(Ae);De.WORKER_NAME="geojson.js",e.loadBorders=_,e.loadBstones=S,e.TSurfLoader=ge,e.loadPLine=A,e.loadTSurf=C,e.loadVSet=M,e.Shaders=we,e.DefaultWorldFactory=Te,e.LabelSwitch=Re,e.VerticalExagerate=_e,e.FileDrop=Se,e.Parser=Ae,e.Transformer=Ce,e.GocadParser=Me,e.GeoJsonParser=De,e.CoordinateSystem=D,e.Document=H,e.PLine=z,e.PLineHeader=P,e.Properties=F,e.TSolid=I,e.TSurf=k,e.TypeFactory=V,e.Unknown=N,e.Vertex=B,e.VSet=G,e.VSetHeader=X,e.DocumentBufferedReader=re,e.fileBufferedReader=f,e.TypeFactoryBufferedReader=te,e.DocumentReader=ye,e.fileReader=w,e.TypeFactoryReader=ve,e.deepMerge=T,e.EventDispatcher=Ee,e.LinePusher=me,e.LineReader=xe,e.range=O,e.parseXml=R,e.toBool=i,e.flowThru=o,e.toColor=s,e.Header=L,e.Type=j,Object.defineProperty(e,"__esModule",{value:!0})});